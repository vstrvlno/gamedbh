import os
import logging
import asyncio
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from aiohttp import web

# ----------------------------
# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏
# ----------------------------
BOT_TOKEN = os.getenv("BOT_TOKEN")
ADMIN_ID = int(os.getenv("ADMIN_ID", "0"))

if not BOT_TOKEN:
    raise ValueError("‚ùå BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è!")

bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()

players = {}

# ----------------------------
# üß© –°—é–∂–µ—Ç (100 —à–∞–≥–æ–≤)
# ----------------------------

story = {
    1: {"text": "–í—ã ‚Äî –∞–Ω–¥—Ä–æ–∏–¥-–¥–µ—Ç–µ–∫—Ç–∏–≤. –°–µ–≥–æ–¥–Ω—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–æ–≤–æ–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ.",
        "choices": {"a": {"text": "–ò–¥—Ç–∏ –Ω–∞ –º–µ—Å—Ç–æ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è", "next": 2},
                    "b": {"text": "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤", "next": 0},
                    "c": {"text": "–°–æ–±—Ä–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º–æ–º", "next": 3}}},
    2: {"text": "–ù–∞ –º–µ—Å—Ç–µ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤—ã –≤–∏–¥–∏—Ç–µ —Å–ª–µ–¥—ã –∫—Ä–æ–≤–∏ –∏ —Ü–∏—Ñ—Ä–æ–≤–æ–π —Å–ª–µ–¥.",
        "choices": {"a": {"text": "–°–ª–µ–¥–æ–≤–∞—Ç—å –∑–∞ –∫—Ä–æ–≤—å—é", "next": 4},
                    "b": {"text": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–∏—Ñ—Ä–æ–≤–æ–π —Å–ª–µ–¥", "next": 5},
                    "c": {"text": "–í—ã–∑–≤–∞—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–æ–≤", "next": 6}}},
    3: {"text": "–í—ã –∏–∑—É—á–∞–µ—Ç–µ –¥–æ—Å—å–µ. –ü–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–π –±—ã–ª –∏–Ω–∂–µ–Ω–µ—Ä–æ–º –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏–∏ CyberLife.",
        "choices": {"a": {"text": "–ü–æ—Å–µ—Ç–∏—Ç—å –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏—é", "next": 7},
                    "b": {"text": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ –∂–∏–ª—å—ë", "next": 8},
                    "c": {"text": "–ó–∞–∫—Ä—ã—Ç—å –¥–æ—Å—å–µ", "next": 0}}},
    4: {"text": "–°–ª–µ–¥ –ø—Ä–∏–≤–æ–¥–∏—Ç –≤–∞—Å –≤ –ø–æ–¥–≤–∞–ª —Å—Ç–∞—Ä–æ–≥–æ –¥–æ–º–∞.",
        "choices": {"a": {"text": "–°–ø—É—Å—Ç–∏—Ç—å—Å—è –≤–Ω–∏–∑", "next": 9},
                    "b": {"text": "–í—ã–∑–≤–∞—Ç—å –ø–æ–¥–∫—Ä–µ–ø–ª–µ–Ω–∏–µ", "next": 6},
                    "c": {"text": "–£–π—Ç–∏", "next": 0}}},
    5: {"text": "–¶–∏—Ñ—Ä–æ–≤–æ–π —Å–ª–µ–¥ –≤–µ–¥—ë—Ç –≤ —Å–µ—Ç—å –ø–æ–¥–ø–æ–ª—å–Ω—ã—Ö –∞–Ω–¥—Ä–æ–∏–¥–æ–≤.",
        "choices": {"a": {"text": "–í–∑–ª–æ–º–∞—Ç—å —Å–∏—Å—Ç–µ–º—É", "next": 10},
                    "b": {"text": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –≤ —à—Ç–∞–±", "next": 6},
                    "c": {"text": "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å", "next": 0}}},
    6: {"text": "–ü–æ–¥–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–æ. –í—ã –æ–±—Å—É–∂–¥–∞–µ—Ç–µ –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π.",
        "choices": {"a": {"text": "–ù–∞–ø–∞—Å—Ç—å –Ω–∞ —É–∫—Ä—ã—Ç–∏–µ", "next": 11},
                    "b": {"text": "–ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–∏—Ç—å", "next": 12},
                    "c": {"text": "–ñ–¥–∞—Ç—å –ø—Ä–∏–∫–∞–∑–∞", "next": 13}}},
    7: {"text": "–í –æ—Ñ–∏—Å–µ CyberLife –≤–∞—Å –≤—Å—Ç—Ä–µ—á–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä.",
        "choices": {"a": {"text": "–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ä–¥–µ—Ä", "next": 14},
                    "b": {"text": "–ü–æ–π—Ç–∏ –±–µ–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è", "next": 0},
                    "c": {"text": "–°–æ–±—Ä–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–µ–∑–∞–º–µ—Ç–Ω–æ", "next": 15}}},
    8: {"text": "–í –¥–æ–º–µ –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º–æ–≥–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ –∞–Ω–¥—Ä–æ–∏–¥–æ–≤ –±–µ–∑ —Å–æ–∑–Ω–∞–Ω–∏—è.",
        "choices": {"a": {"text": "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω–æ–≥–æ", "next": 16},
                    "b": {"text": "–û—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–º", "next": 17},
                    "c": {"text": "–£–π—Ç–∏", "next": 0}}},
    9: {"text": "–ü–æ–¥–≤–∞–ª –ø—É—Å—Ç, –Ω–æ –∞–∫—Ç–∏–≤–µ–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª.",
        "choices": {"a": {"text": "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è", "next": 18},
                    "b": {"text": "–£–Ω–∏—á—Ç–æ–∂–∏—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª", "next": 0},
                    "c": {"text": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —à—Ç–∞–±—É", "next": 19}}},
    10: {"text": "–í–∑–ª–æ–º —É–¥–∞–ª—Å—è. –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±–∞–∑—ã –∞–Ω–¥—Ä–æ–∏–¥–æ–≤.",
         "choices": {"a": {"text": "–ò–¥—Ç–∏ —Ç—É–¥–∞", "next": 20},
                     "b": {"text": "–°–æ–æ–±—â–∏—Ç—å –∫–æ–º–∞–Ω–¥–µ", "next": 6},
                     "c": {"text": "–£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ", "next": 0}}},

    # ---- –•–æ–¥—ã 11‚Äì30 ----
    11: {"text": "–í—ã —à—Ç—É—Ä–º—É–µ—Ç–µ —É–∫—Ä—ã—Ç–∏–µ. –í–Ω—É—Ç—Ä–∏ –∏–¥—ë—Ç –±–æ–π.",
         "choices": {"a": {"text": "–ü—Ä–æ–¥–≤–∏–≥–∞—Ç—å—Å—è –≤–ø–µ—Ä—ë–¥", "next": 21},
                     "b": {"text": "–û—Ç—Å—Ç—É–ø–∏—Ç—å", "next": 0},
                     "c": {"text": "–ò—Å–∫–∞—Ç—å –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å", "next": 22}}},
    12: {"text": "–í—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å —É–±–µ–¥–∏—Ç—å –ª–∏–¥–µ—Ä–∞ –∞–Ω–¥—Ä–æ–∏–¥–æ–≤ —Å–¥–∞—Ç—å—Å—è.",
         "choices": {"a": {"text": "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É", "next": 23},
                     "b": {"text": "–ü—Ä–æ—è–≤–∏—Ç—å —Å–æ—á—É–≤—Å—Ç–≤–∏–µ", "next": 24},
                     "c": {"text": "–£–≥—Ä–æ–∂–∞—Ç—å", "next": 0}}},
    13: {"text": "–ü–æ–∫–∞ –≤—ã –∂–¥—ë—Ç–µ, –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∏ —É—Å–ø–µ–≤–∞—é—Ç —Å–∫—Ä—ã—Ç—å—Å—è.",
         "choices": {"a": {"text": "–ü—Ä–µ—Å–ª–µ–¥–æ–≤–∞—Ç—å", "next": 25},
                     "b": {"text": "–û—Å—Ç–∞—Ç—å—Å—è –Ω–∞ –º–µ—Å—Ç–µ", "next": 0},
                     "c": {"text": "–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥—Ä–æ–Ω–∞", "next": 26}}},
    14: {"text": "–î–∏—Ä–µ–∫—Ç–æ—Ä —Å–æ–≥–ª–∞—à–∞–µ—Ç—Å—è –Ω–∞ –¥–æ–ø—Ä–æ—Å.",
         "choices": {"a": {"text": "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –æ –ø—Ä–æ–µ–∫—Ç–∞—Ö", "next": 27},
                     "b": {"text": "–ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ —Ä–µ–∞–∫—Ü–∏–µ–π", "next": 28},
                     "c": {"text": "–£–π—Ç–∏", "next": 0}}},
    15: {"text": "–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ —Å–∫—Ä—ã—Ç—ã–π —Å–µ—Ä–≤–µ—Ä –∫–æ–º–ø–∞–Ω–∏–∏.",
         "choices": {"a": {"text": "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ", "next": 29},
                     "b": {"text": "–í–∑–ª–æ–º–∞—Ç—å —Å–µ—Ä–≤–µ—Ä", "next": 30},
                     "c": {"text": "–°–æ–æ–±—â–∏—Ç—å –Ω–∞—á–∞–ª—å—Å—Ç–≤—É", "next": 6}}},
    16: {"text": "–ê–Ω–¥—Ä–æ–∏–¥ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –∏ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –≤–∞—Å.",
         "choices": {"a": {"text": "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å", "next": 31},
                     "b": {"text": "–í—ã–∫–ª—é—á–∏—Ç—å –µ–≥–æ", "next": 0},
                     "c": {"text": "–û—Å–≤–æ–±–æ–¥–∏—Ç—å", "next": 32}}},
    17: {"text": "–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ —É–ª–∏–∫–∏, —É–∫–∞–∑—ã–≤–∞—é—â–∏–µ –Ω–∞ —Å–µ—Ç—å –º—è—Ç–µ–∂–Ω–∏–∫–æ–≤.",
         "choices": {"a": {"text": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç", "next": 6},
                     "b": {"text": "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∏—Å–∫", "next": 33},
                     "c": {"text": "–£–Ω–∏—á—Ç–æ–∂–∏—Ç—å —É–ª–∏–∫–∏", "next": 0}}},
    18: {"text": "–í—ã –ø–æ–¥–∫–ª—é—á–∞–µ—Ç–µ—Å—å –∫ —Ç–µ—Ä–º–∏–Ω–∞–ª—É ‚Äî —Ç–∞–º –≤–∏—Ä—É—Å.",
         "choices": {"a": {"text": "–û—Ç–∫–ª—é—á–∏—Ç—å—Å—è", "next": 0},
                     "b": {"text": "–ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—É—Å", "next": 34},
                     "c": {"text": "–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≥–ª—É–±–∂–µ", "next": 35}}},
    19: {"text": "–®—Ç–∞–± –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç –∑–∞ –¥–∞–Ω–Ω—ã–µ. –ù–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã.",
         "choices": {"a": {"text": "–°–ª–µ–¥–æ–≤–∞—Ç—å —Ç—É–¥–∞", "next": 36},
                     "b": {"text": "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å", "next": 0},
                     "c": {"text": "–ü–µ—Ä–µ–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–ø–µ—Ü–æ—Ç—Ä—è–¥—É", "next": 37}}},
    20: {"text": "–í—ã –ø—Ä–∏–±—ã–≤–∞–µ—Ç–µ –∫ –±–∞–∑–µ –∞–Ω–¥—Ä–æ–∏–¥–æ–≤ –≤ –≥–æ—Ä–∞—Ö.",
         "choices": {"a": {"text": "–ü—Ä–æ–Ω–∏–∫–Ω—É—Ç—å —Ç–∞–π–Ω–æ", "next": 38},
                     "b": {"text": "–ó–∞–π—Ç–∏ –≤ –æ—Ç–∫—Ä—ã—Ç—É—é", "next": 0},
                     "c": {"text": "–ü–æ–¥–æ–∂–¥–∞—Ç—å –Ω–æ—á–∏", "next": 39}}},

    # ---- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —à–∞–≥–∏ (31‚Äì60) ----
    31: {"text": "–ê–Ω–¥—Ä–æ–∏–¥ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç –æ –∑–∞–≥–æ–≤–æ—Ä–µ –≤–Ω—É—Ç—Ä–∏ CyberLife.",
         "choices": {"a": {"text": "–ó–∞–ø–∏—Å–∞—Ç—å –≤—Å—ë", "next": 40},
                     "b": {"text": "–°–æ–æ–±—â–∏—Ç—å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É", "next": 41},
                     "c": {"text": "–ù–µ –≤–µ—Ä–∏—Ç—å –µ–º—É", "next": 0}}},
    32: {"text": "–û—Å–≤–æ–±–æ–∂–¥—ë–Ω–Ω—ã–π –∞–Ω–¥—Ä–æ–∏–¥ –ø–æ–º–æ–≥–∞–µ—Ç –≤–∞–º –Ω–∞–π—Ç–∏ —É–∫—Ä—ã—Ç–∏–µ.",
         "choices": {"a": {"text": "–°–ª–µ–¥–æ–≤–∞—Ç—å –∑–∞ –Ω–∏–º", "next": 42},
                     "b": {"text": "–ù–µ –¥–æ–≤–µ—Ä—è—Ç—å", "next": 0},
                     "c": {"text": "–°–æ–æ–±—â–∏—Ç—å –Ω–∞–ø–∞—Ä–Ω–∏–∫—É", "next": 43}}},
    33: {"text": "–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ —Å–∫—Ä—ã—Ç—É—é –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é.",
         "choices": {"a": {"text": "–í–æ–π—Ç–∏", "next": 44},
                     "b": {"text": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã", "next": 37},
                     "c": {"text": "–í–∑–æ—Ä–≤–∞—Ç—å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é", "next": 0}}},
    34: {"text": "–í—ã —É—Å–ø–µ—à–Ω–æ –∏–∑–æ–ª–∏—Ä—É–µ—Ç–µ –≤–∏—Ä—É—Å –∏ –ø–æ–ª—É—á–∞–µ—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º.",
         "choices": {"a": {"text": "–ò–∑—É—á–∏—Ç—å –ª–æ–≥–∏", "next": 45},
                     "b": {"text": "–£–¥–∞–ª–∏—Ç—å –∏—Ö", "next": 0},
                     "c": {"text": "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å", "next": 46}}},
    35: {"text": "–í–∏—Ä—É—Å –∑–∞—Ä–∞–∂–∞–µ—Ç –≤–∞—à—É —Å–∏—Å—Ç–µ–º—É. –í—ã —Ç–µ—Ä—è–µ—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª—å.",
         "choices": {"a": {"text": "–ë–æ—Ä–æ—Ç—å—Å—è", "next": 47},
                     "b": {"text": "–°–¥–∞—Ç—å—Å—è", "next": 0},
                     "c": {"text": "–û—Ç–∫–ª—é—á–∏—Ç—å –ø–∏—Ç–∞–Ω–∏–µ", "next": 48}}},
    36: {"text": "–í—ã –ø—Ä–∏–±—ã–≤–∞–µ—Ç–µ –Ω–∞ –Ω–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.",
         "choices": {"a": {"text": "–ü—Ä–æ–Ω–∏–∫–Ω—É—Ç—å –≤–Ω—É—Ç—Ä—å", "next": 49},
                     "b": {"text": "–ñ–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã", "next": 50},
                     "c": {"text": "–ü–æ–∫–∏–Ω—É—Ç—å –º–∏—Å—Å–∏—é", "next": 0}}},
    37: {"text": "–°–ø–µ—Ü–æ—Ç—Ä—è–¥ –¥–µ–π—Å—Ç–≤—É–µ—Ç –ø–æ –≤–∞—à–∏–º –¥–∞–Ω–Ω—ã–º. –í—ã –Ω–∞–±–ª—é–¥–∞–µ—Ç–µ –∏–∑–¥–∞–ª–µ–∫–∞.",
         "choices": {"a": {"text": "–í–º–µ—à–∞—Ç—å—Å—è", "next": 51},
                     "b": {"text": "–û—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–º", "next": 52},
                     "c": {"text": "–ü–æ–º–æ—á—å –∏–º —Ç–∞–π–Ω–æ", "next": 53}}},
    38: {"text": "–í—ã –∫—Ä–∞–¥—ë—Ç–µ—Å—å –ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É –±–∞–∑—ã.",
         "choices": {"a": {"text": "–ü—Ä–æ–Ω–∏–∫–Ω—É—Ç—å –≤–Ω—É—Ç—Ä—å", "next": 54},
                     "b": {"text": "–í–µ—Ä–Ω—É—Ç—å—Å—è", "next": 0},
                     "c": {"text": "–í—ã–∑–≤–∞—Ç—å –¥—Ä–æ–Ω-—Ä–∞–∑–≤–µ–¥—á–∏–∫", "next": 55}}},
    39: {"text": "–ù–æ—á—å –Ω–∞—Å—Ç—É–ø–∞–µ—Ç. –û—Ö—Ä–∞–Ω–∞ –æ—Å–ª–∞–±–ª–∞.",
         "choices": {"a": {"text": "–ü—Ä–æ–Ω–∏–∫–Ω—É—Ç—å", "next": 54},
                     "b": {"text": "–û–∂–∏–¥–∞—Ç—å —Ä–∞—Å—Å–≤–µ—Ç–∞", "next": 0},
                     "c": {"text": "–£—Å—Ç—Ä–æ–∏—Ç—å –∑–∞—Å–∞–¥—É", "next": 56}}},

    # ---- –°—Ä–µ–¥–Ω–∏–µ —Ö–æ–¥—ã (61‚Äì90) ----
    61: {"text": "–í—ã –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç–µ—Å—å –∫ —Ñ–∏–Ω–∞–ª—É —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.",
         "choices": {"a": {"text": "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ —É–ª–∏–∫–∏", "next": 91},
                     "b": {"text": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ø–∞—Ä–Ω–∏–∫–∞", "next": 62},
                     "c": {"text": "–ü–æ–π—Ç–∏ –≤ –æ–¥–∏–Ω–æ—á–∫—É", "next": 0}}},
    62: {"text": "–ù–∞–ø–∞—Ä–Ω–∏–∫ –≤–µ–¥—ë—Ç —Å–µ–±—è —Å—Ç—Ä–∞–Ω–Ω–æ. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω –ø—Ä–µ–¥–∞—Ç–µ–ª—å.",
         "choices": {"a": {"text": "–°–ª–µ–¥–∏—Ç—å –∑–∞ –Ω–∏–º", "next": 63},
                     "b": {"text": "–î–æ–≤–µ—Ä–∏—Ç—å—Å—è –µ–º—É", "next": 0},
                     "c": {"text": "–°–æ–æ–±—â–∏—Ç—å –≤ —à—Ç–∞–±", "next": 64}}},
    63: {"text": "–í—ã —Å–ª–µ–¥–∏—Ç–µ –∏ —É–∑–Ω–∞—ë—Ç–µ: –Ω–∞–ø–∞—Ä–Ω–∏–∫ —Å–≤—è–∑–∞–Ω —Å CyberLife.",
         "choices": {"a": {"text": "–ê—Ä–µ—Å—Ç–æ–≤–∞—Ç—å", "next": 65},
                     "b": {"text": "–î–∞—Ç—å —à–∞–Ω—Å –æ–±—ä—è—Å–Ω–∏—Ç—å—Å—è", "next": 66},
                     "c": {"text": "–û—Ç—Å—Ç—É–ø–∏—Ç—å", "next": 0}}},
    64: {"text": "–®—Ç–∞–± —Ç—Ä–µ–±—É–µ—Ç –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞.",
         "choices": {"a": {"text": "–°–æ–±—Ä–∞—Ç—å —É–ª–∏–∫–∏", "next": 67},
                     "b": {"text": "–ü–æ–¥–¥–µ–ª–∞—Ç—å –æ—Ç—á—ë—Ç", "next": 0},
                     "c": {"text": "–û—Ç–ª–æ–∂–∏—Ç—å —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ", "next": 68}}},
    65: {"text": "–í—ã –∞—Ä–µ—Å—Ç–æ–≤–∞–ª–∏ –Ω–∞–ø–∞—Ä–Ω–∏–∫–∞. –û–Ω –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ –ª–æ–≤—É—à–∫–µ.",
         "choices": {"a": {"text": "–û—Å–≤–æ–±–æ–¥–∏—Ç—å", "next": 69},
                     "b": {"text": "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å", "next": 70},
                     "c": {"text": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≤—É—à–∫—É", "next": 71}}},
    66: {"text": "–ù–∞–ø–∞—Ä–Ω–∏–∫ –ø—Ä–∏–∑–Ω–∞—ë—Ç—Å—è, —á—Ç–æ —Ö–æ—Ç–µ–ª –≤–∞—Å –∑–∞—â–∏—Ç–∏—Ç—å.",
         "choices": {"a": {"text": "–ü—Ä–æ—Å—Ç–∏—Ç—å", "next": 72},
                     "b": {"text": "–ù–µ –≤–µ—Ä–∏—Ç—å", "next": 0},
                     "c": {"text": "–°–æ–æ–±—â–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–≤–∞–Ω–∏—é", "next": 73}}},

    # ---- –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ö–æ–¥—ã (91‚Äì100) ----
    91: {"text": "–í—Å–µ —É–ª–∏–∫–∏ —Å–æ–±—Ä–∞–Ω—ã. –û—Å—Ç–∞–ª–æ—Å—å —Ä–∞—Å–∫—Ä—ã—Ç—å –∑–∞–≥–æ–≤–æ—Ä.",
         "choices": {"a": {"text": "–ü–æ–π—Ç–∏ –≤ —à—Ç–∞–± CyberLife", "next": 94},
                     "b": {"text": "–í—ã–∑–≤–∞—Ç—å –ø—Ä–µ—Å—Å—É", "next": 95},
                     "c": {"text": "–£–Ω–∏—á—Ç–æ–∂–∏—Ç—å —É–ª–∏–∫–∏", "next": 0}}},
    94: {"text": "–í—ã –ø—Ä–æ–Ω–∏–∫–∞–µ—Ç–µ –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ—Ñ–∏—Å CyberLife.",
         "choices": {"a": {"text": "–í–∑–ª–æ–º–∞—Ç—å –≥–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä", "next": 97},
                     "b": {"text": "–ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —É–≥–æ–≤–æ—Ä–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞", "next": 98},
                     "c": {"text": "–û—Ç—Å—Ç—É–ø–∏—Ç—å", "next": 0}}},
    95: {"text": "–ü—Ä–µ—Å—Å–∞ –ø–æ–¥–Ω–∏–º–∞–µ—Ç —à—É–º. CyberLife —Ç–µ—Ä—è–µ—Ç –≤–ª–∏—è–Ω–∏–µ.",
         "choices": {"a": {"text": "–ü—Ä–∏–Ω—è—Ç—å –Ω–∞–≥—Ä–∞–¥—É –∏ —É–π—Ç–∏", "next": -1},
                     "b": {"text": "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–æ—Ä—å–±—É", "next": 99}}},
    97: {"text": "–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞, —á—Ç–æ –∫–æ–º–ø–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∞–Ω–¥—Ä–æ–∏–¥–æ–≤.",
         "choices": {"a": {"text": "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ", "next": 99},
                     "b": {"text": "–°–∫—Ä—ã—Ç—å –ø—Ä–∞–≤–¥—É", "next": 0}}},
    98: {"text": "–î–∏—Ä–µ–∫—Ç–æ—Ä –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–¥–µ–ª–∫—É.",
         "choices": {"a": {"text": "–°–æ–≥–ª–∞—Å–∏—Ç—å—Å—è", "next": 0},
                     "b": {"text": "–û—Ç–∫–∞–∑–∞—Ç—å", "next": 99}}},
    99: {"text": "–ò—Å—Ç–∏–Ω–∞ —Ä–∞—Å–∫—Ä—ã—Ç–∞. –õ—é–¥–∏ –∏ –∞–Ω–¥—Ä–æ–∏–¥—ã –ø–æ–ª—É—á–∞—é—Ç —à–∞–Ω—Å –Ω–∞ –º–∏—Ä.",
         "choices": {"a": {"text": "–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é", "next": -1}}}
}

# ----------------------------
# üéÆ –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã
# ----------------------------
@dp.message(Command("start"))
async def start_game(message: types.Message):
    """–ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–π –∏–≥—Ä—ã"""
    user_id = message.from_user.id
    players[user_id] = {"current": 1, "status": "playing"}
    await send_story(message, user_id)


async def send_story(message: types.Message, user_id: int):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—É—â–µ–π —Å—Ü–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
    state = players[user_id]
    current = state["current"]

    if state["status"] != "playing":
        return

    # –ü—Ä–æ–∏–≥—Ä—ã—à
    if current == 0:
        await message.answer("–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏. –ö–æ–Ω–µ—Ü –∏—Å—Ç–æ—Ä–∏–∏.")
        state["status"] = "lost"
        return

    # –ü–æ–±–µ–¥–∞
    if current == -1:
        await message.answer("–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ò—Å—Ç–æ—Ä–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")
        state["status"] = "finished"
        return

    # –ü–æ–ª—É—á–∞–µ–º —Å–æ–±—ã—Ç–∏–µ
    event = story.get(current)
    if not event:
        await message.answer("–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å.")
        state["status"] = "finished"
        return

    text = event["text"]

    # ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    keyboard = InlineKeyboardMarkup(inline_keyboard=[])
    for key, choice in event.get("choices", {}).items():
        button = InlineKeyboardButton(text=choice["text"], callback_data=key)
        keyboard.inline_keyboard.append([button])

    await message.answer(text, reply_markup=keyboard)


@dp.callback_query()
async def handle_choice(callback: types.CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    user_id = callback.from_user.id

    if user_id not in players or players[user_id]["status"] != "playing":
        await callback.answer("–ò–≥—Ä–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞. –ù–∞–±–µ—Ä–∏—Ç–µ /start")
        return




