class Chapter2:
    def __init__(self, player):
        self.player = player
        self.current_scene = "intro"

    def play(self, choice=None):
        if self.current_scene == "intro":
            text = (
                "ГЛАВА 2: Пепел и эхо\n\n"
                "Ты покидаешь старую лабораторию. За спиной — пепел города, впереди — тишина и дрожащий горизонт.\n"
                "Твоя цель всё та же: найти вакцину и понять, почему началась эпидемия.\n"
                "Ветер несёт запах гари и металла. На развилке ты видишь два пути:\n"
                "1. Узкая улица, где слышны шаги.\n"
                "2. Тоннель метро, уходящий в темноту.\n"
                "3. Заброшенный госпиталь на холме."
            )
            options = {
                "1": "street_encounter",
                "2": "metro_tunnel",
                "3": "hospital_entry"
            }

        elif self.current_scene == "street_encounter":
            text = (
                "Ты идёшь по улице, стараясь не шуметь. Из-за угла выходят трое выживших.\n"
                "Они выглядят измотанными, но вооружены.\n\n"
                "Один из них поднимает руку: 'Стой. Кто ты?'\n"
                "1. Представиться честно.\n"
                "2. Солгать, сказав, что ты посланник правительства.\n"
                "3. Сразу достать оружие."
            )
            options = {
                "1": "survivor_trust",
                "2": "survivor_lie",
                "3": "street_fight"
            }

        elif self.current_scene == "survivor_trust":
            text = (
                "Ты рассказываешь правду. Мужчина смотрит тебе прямо в глаза и кивает.\n"
                "'Мы тоже ищем вакцину,' — говорит он. — 'Можем объединиться.'\n"
                "1. Принять их помощь.\n"
                "2. Отказаться и идти один."
            )
            options = {
                "1": "ally_join",
                "2": "solo_continue"
            }

        elif self.current_scene == "survivor_lie":
            text = (
                "Ты говоришь, что представляешь правительство. Они переглядываются. Лидер щурится.\n"
                "— Тогда покажи удостоверение.\n"
                "Ты начинаешь мяться. Он достаёт пистолет.\n\n"
                "1. Попробовать бежать.\n"
                "2. Признаться во лжи.\n"
                "3. Напасть первым."
            )
            options = {
                "1": "run_fail",
                "2": "trust_restored",
                "3": "street_fight"
            }

        elif self.current_scene == "street_fight":
            text = (
                "Ты стреляешь первым. Один падает, но двое открывают ответный огонь.\n"
                "Пуля задевает тебе плечо. Ты падаешь на колено...\n"
                "1. Отступить в подвал.\n"
                "2. Продолжать бой.\n"
                "3. Сдаться."
            )
            options = {
                "1": "escape_basement",
                "2": "death_street",
                "3": "captured"
            }

        elif self.current_scene == "run_fail":
            text = (
                "Ты бросаешься бежать, но один из выживших стреляет.\n"
                "Пуля попадает тебе в спину. Ты падаешь лицом в пыль.\n\n"
                "История закончилась. Ты погиб, потому что попытался сбежать, не оценив угрозу."
            )
            options = {}

        elif self.current_scene == "death_street":
            text = (
                "Ты продолжаешь стрелять, но силы неравны.\n"
                "Последнее, что ты видишь — это вспышка пламени перед глазами.\n\n"
                "История закончилась. Ты умер в перестрелке."
            )
            options = {}

        elif self.current_scene == "captured":
            text = (
                "Они связывают тебе руки и ведут в подвал.\n"
                "Через несколько часов ты слышишь шаги — это лидер.\n"
                "— Хочешь жить? Тогда расскажи, где лаборатория.\n"
                "1. Сказать правду.\n"
                "2. Молчать."
            )
            options = {
                "1": "trust_restored",
                "2": "execution"
            }

        elif self.current_scene == "execution":
            text = (
                "Ты молчишь. Они уводят тебя во двор.\n"
                "Последнее, что ты слышишь — взвод затвора.\n"
                "История закончилась. Ты погиб, потому что выбрал честь вместо лжи."
            )
            options = {}

        elif self.current_scene == "trust_restored":
            text = (
                "После признания тебя отпускают.\n"
                "Мужчина говорит: 'Теперь хотя бы знаем, что ты не враг.'\n"
                "Они дают тебе немного еды и указывают дорогу на север — туда, где, по слухам, ещё работает центр исследований."
            )
            options = {"далее": "north_road"}

        elif self.current_scene == "ally_join":
            text = (
                "Теперь вы — группа из четырёх. Один из них медик, другой механик.\n"
                "Вы направляетесь к северной окраине города, где, по легендам, был склад вакцин.\n"
                "На пути вы видите заброшенный мост.\n"
                "1. Перейти по мосту.\n"
                "2. Обойти через туннель."
            )
            options = {
                "1": "bridge_event",
                "2": "tunnel_path"
            }

        elif self.current_scene == "solo_continue":
            text = (
                "Ты идёшь один. Мир кажется ещё более пустым.\n"
                "Вдруг радио оживает — кто-то зовёт на помощь. Женский голос, слабый, дрожащий.\n"
                "1. Ответить на вызов.\n"
                "2. Игнорировать и идти дальше."
            )
            options = {
                "1": "radio_rescue",
                "2": "north_road"
            }

        elif self.current_scene == "radio_rescue":
            text = (
                "Ты находишь девушку, зажатую под обломками. Она ранена, но жива.\n"
                "Ты тратишь последние силы, чтобы её вытащить.\n"
                "Она благодарит тебя и говорит: 'Я знаю, где хранилась вакцина. На военной базе за городом.'\n"
                "Теперь у тебя новая цель."
            )
            options = {"далее": "north_road"}

        elif self.current_scene == "bridge_event":
            text = (
                "Вы идёте по мосту. Ветер ревёт. Старая конструкция дрожит.\n"
                "Посередине моста раздаётся скрежет — тросы рвутся!\n"
                "1. Прыгнуть на другую сторону.\n"
                "2. Вернуться назад.\n"
                "3. Попробовать удержать мост."
            )
            options = {
                "1": "jump_success",
                "2": "tunnel_path",
                "3": "bridge_collapse"
            }

        elif self.current_scene == "bridge_collapse":
            text = (
                "Ты пытаешься удержать мост, но он рушится под вашими ногами.\n"
                "Вы падаете вниз, в реку, и всё тонет во мраке.\n"
                "История закончилась. Ты погиб, потому что пытался спасти то, что уже нельзя спасти."
            )
            options = {}

        elif self.current_scene == "jump_success":
            text = (
                "Ты прыгаешь — и чудом цепляешься за край.\n"
                "Остальные следом. Один не успевает, его крик растворяется в буре.\n"
                "Вы выбираетесь, потеряв одного, но сохранив шанс выжить.\n"
                "Дальше путь ведёт на север, к базе."
            )
            options = {"далее": "north_road"}

        elif self.current_scene == "tunnel_path":
            text = (
                "Туннель длинный и сырой. Запах плесени и смерти.\n"
                "Из темноты слышится рычание... мутанты.\n"
                "1. Бежать.\n"
                "2. Сражаться.\n"
                "3. Прятаться в вентиляции."
            )
            options = {
                "1": "escape_success",
                "2": "fight_mutants",
                "3": "vent_escape"
            }

        elif self.current_scene == "fight_mutants":
            text = (
                "Вы отбиваетесь, но один мутант хватает медика.\n"
                "Ты вынужден стрелять.\n"
                "После боя — тишина. Двое остались живы.\n"
                "Ты чувствуешь, что теряешь человечность, но идёшь дальше."
            )
            options = {"далее": "north_road"}

        elif self.current_scene == "vent_escape":
            text = (
                "Ты забираешься в вентиляцию и ползёшь на свет.\n"
                "Через несколько минут оказываешься снаружи. Свежий воздух.\n"
                "Позади — мрак, впереди — север."
            )
            options = {"далее": "north_road"}

        elif self.current_scene == "escape_success":
            text = (
                "Вы убегаете из туннеля, чудом спасаясь.\n"
                "Один падает, но ты не можешь вернуться.\n"
                "Слёзы текут по лицу, но времени нет. Путь на север открыт."
            )
            options = {"далее": "north_road"}

        elif self.current_scene == "north_road":
            text = (
                "Вы выходите на дорогу, ведущую к военной базе.\n"
                "Север сияет отблесками костров. Там кто-то жив.\n"
                "Впереди новая глава..."
            )
            options = {}

        else:
            text = "Ошибка сюжета. Неизвестная сцена."
            options = {}

        # Если игрок сделал выбор — обновляем сцену
        if choice and choice in options:
            self.current_scene = options[choice]

        return text, options
