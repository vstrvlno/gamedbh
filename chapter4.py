class Chapter4:
    def __init__(self, player):
        self.player = player
        self.current_scene = "intro"

    def play(self, choice=None):
        if self.current_scene == "intro":
            text = (
                "ГЛАВА 4: Новая эра\n\n"
                "После взрыва базы ты бредёшь через выжженные равнины. "
                "Мир изменился: небо серое, воздух густой, а тишина давит сильнее боли.\n"
                "В руке — контейнер с вакциной или флешка с её формулой.\n"
                "Ты чувствуешь, что всё, что осталось, зависит от тебя.\n\n"
                "Вдалеке виднеются три направления:\n"
                "1. Старый купол мегаполиса — там, возможно, выжившие.\n"
                "2. Радиовышка на холме — можно связаться с другими регионами.\n"
                "3. Разрушенная лаборатория, откуда начался вирус — место, где всё можно закончить."
            )
            options = {
                "1": "go_city",
                "2": "go_tower",
                "3": "go_lab_ruins"
            }

        elif self.current_scene == "go_city":
            text = (
                "Ты подходишь к куполу города. Вход охраняют вооружённые выжившие. "
                "Они направляют оружие на тебя.\n"
                "— Покажи, что несёшь, — требует лидер.\n\n"
                "1. Показать вакцину.\n"
                "2. Сказать, что ты просто странник.\n"
                "3. Спрятать и попытаться сбежать.\n"
                "4. Попробовать убедить их, что ты спаситель."
            )
            options = {
                "1": "city_conflict",
                "2": "city_denied",
                "3": "city_escape",
                "4": "city_savior"
            }

        elif self.current_scene == "go_tower":
            text = (
                "Ты добираешься до радиовышки. Она еле держится, но терминал всё ещё работает. "
                "На экране мигает: 'Связь с Севером: установлена'.\n"
                "1. Передать данные о вакцине.\n"
                "2. Отправить ложный сигнал, чтобы никто не нашёл формулу.\n"
                "3. Попросить помощи и эвакуации.\n"
                "4. Взломать систему и перехватить радиочастоты."
            )
            options = {
                "1": "broadcast_vaccine",
                "2": "fake_signal",
                "3": "request_help",
                "4": "hack_tower"
            }

        elif self.current_scene == "go_lab_ruins":
            text = (
                "Ты возвращаешься туда, где всё началось. "
                "Развалины лаборатории дымятся. Среди обломков — странное свечение.\n"
                "Ты видишь капсулу с мутировавшей версией вируса.\n"
                "1. Уничтожить всё огнём.\n"
                "2. Ввести себе модифицированный вирус.\n"
                "3. Попробовать синтезировать новую формулу.\n"
                "4. Просто уйти."
            )
            options = {
                "1": "purge_lab",
                "2": "infect_self",
                "3": "synthesize",
                "4": "leave_ruins"
            }

        elif self.current_scene == "city_conflict":
            text = (
                "Ты показываешь вакцину. Толпа замирает.\n"
                "— Он говорит правду! — кричит кто-то. "
                "Но лидер хватает оружие: 'Если это вирус — мы все мертвы!'\n\n"
                "1. Отдать вакцину.\n"
                "2. Защититься.\n"
                "3. Попробовать объяснить."
            )
            options = {
                "1": "city_fear",
                "2": "city_shootout",
                "3": "city_talk"
            }

        elif self.current_scene == "city_savior":
            text = (
                "Ты поднимаешь контейнер: 'Я принёс спасение!'\n"
                "Толпа сначала молчит, потом кто-то кидает камень. "
                "Они не верят. Люди боятся больше, чем умирают.\n\n"
                "1. Попробовать убедить.\n"
                "2. Уйти в сторону мегаполиса.\n"
                "3. Отдать вакцину детям."
            )
            options = {
                "1": "city_talk",
                "2": "city_enter",
                "3": "city_hope"
            }

        elif self.current_scene == "city_talk":
            text = (
                "Ты рассказываешь им правду. Как выжил, как нашёл лабораторию, как потерял всех.\n"
                "Люди слушают, но лидер не опускает оружие.\n"
                "— Мы устали от спасителей, — говорит он.\n"
                "Выстрел.\n\n"
                "История закончилась. Ты погиб, потому что мир больше не верит в героев."
            )
            options = {}

        elif self.current_scene == "city_fear":
            text = (
                "Ты отдаёшь вакцину. Они закрывают ворота и исчезают.\n"
                "Через несколько дней ты видишь вдалеке свет — город ожил. "
                "Они выжили, но забыли твое имя.\n\n"
                "История закончилась. Ты спас человечество, но остался призраком."
            )
            options = {}

        elif self.current_scene == "city_shootout":
            text = (
                "Ты открываешь ответный огонь. Начинается хаос. "
                "Ты ранен, но успеваешь сбежать. "
                "Город пылает за спиной.\n\n"
                "История закончилась. Ты выжил, но мир стал еще темнее."
            )
            options = {}

        elif self.current_scene == "city_hope":
            text = (
                "Ты кладёшь вакцину в руки ребёнку. Толпа замолкает. "
                "Через несколько минут мальчик открывает глаза — жив.\n"
                "Люди опускают оружие.\n"
                "Ты спас их.\n\n"
                "История закончилась. Ты победил, потому что поверил в добро, даже когда все вокруг нет."
            )
            options = {}

        elif self.current_scene == "broadcast_vaccine":
            text = (
                "Ты передаёшь формулу на все частоты. "
                "Через минуту слышишь ответ: 'Север принял сигнал. Начинаем производство.'\n"
                "Ты сделал это. Но твой сигнал также поймали те, кто хочет власти.\n\n"
                "1. Отключить вышку.\n"
                "2. Скрыться.\n"
                "3. Оставить всё как есть."
            )
            options = {
                "1": "disable_tower",
                "2": "hide_after_broadcast",
                "3": "final_broadcast"
            }
